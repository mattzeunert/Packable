<app-dialog-header
  [header]="step>1? '' : 'New Traveler' "
  (close)="onClose()"
  [showReturn]="step>1"
  (return)="backStep()"></app-dialog-header>



<ng-container *ngIf="step === 1">
  <mat-dialog-content>
    <div @transitionTrigger>
      <profile-edit-form
        [(profile)]="profile"
        (validChange)="profileEditFormValidation($event)"
        #profileForm>
      </profile-edit-form>
      <div class="mt-3">
        <card-button
          [disabled]="!profileFormValid"
          (click)="profileFormValid && onChooseMethod('new')">
          Select Essentials
          <p class="small text-muted">
            Select what this Traveler would always need.
          </p>
        </card-button>
        <card-button
          [disabled]="storeSelector.isLibraryStore || !profileFormValid"
          (click)="profileFormValid && onChooseMethod('template')">
          Select Traveler Template
          <p class="small text-muted">
            Templates come with pre-selected Essential Collections.
          </p>
        </card-button>
        <card-button
          *ngIf="allProfiles && allProfiles.length > 0"
          [disabled]="!profileFormValid"
          (click)="profileFormValid && onChooseMethod('copy')">
          Copy Traveler
          <p class="small text-muted">
            Copy all the collections and settings of another Traverler you have already created.
          </p>
        </card-button>
      </div>
    </div>
  </mat-dialog-content>
  <mat-dialog-actions>
    <dialog-confirm-button>
      <button
        mat-fab
        class="mx-1"
        activeColor="action"
        (click)="onComplete()"
        [disabled]="!profileFormValid">
        <mat-icon>check</mat-icon>
      </button>
    </dialog-confirm-button>
  </mat-dialog-actions>
</ng-container>
<ng-container
  *ngIf="step === 2"
  [ngSwitch]="method">
  <ng-container *ngSwitchCase="'copy'">
    <mat-dialog-content>
      <div @transitionTrigger>
        <div style="position: sticky;top:0;z-index:1; background: white;">
          <div class="text-center">
            <profile-icon
              [profile]="profile"
              [showName]="true"
              width="65px">
            </profile-icon>
          </div>
          <p class="form-heading">Select a Traveler to copy:</p>
        </div>
        <div>
          <ng-container *ngFor="let profile of allProfiles">
            <card-button (click)="onChooseProfile(profile)">
              <div class="profile-card-flex">
                <div class="profile-card-icon">
                  <profile-icon
                    [profile]="profile"
                    [showName]="false"
                    width="50px">
                  </profile-icon>
                </div>
                <div class="profile-card-details">
                  <h5 class="p-0 m-0">{{profile.name}}</h5>
                  <div class="profile-card-details-collection-list">
                    <list-concatinator
                      [list]="getCollectionListById(profile.id)"
                      lines="2"></list-concatinator>
                  </div>
                </div>
              </div>
            </card-button>
          </ng-container>
        </div>
      </div>
    </mat-dialog-content>
  </ng-container>




  <ng-container *ngSwitchCase="'template'">
    <mat-dialog-content>
      <div @transitionTrigger>
        <div style="position: sticky;top:0;z-index:1; background: white;">
          <div class="text-center">
            <profile-icon
              [profile]="profile"
              [showName]="true"
              width="65px">
            </profile-icon>
          </div>
          <p>Select a Traveler Template:</p>
        </div>
        <div class="dialog-row scrollable">
          <ng-container *ngFor="let profile of templateProfiles">
            <card-button (click)="onChooseProfile(profile)">
              <div class="profile-card-flex">
                <div class="profile-card-icon">
                  <profile-icon
                    [profile]="profile"
                    [fullFrame]="true"
                    color="white"
                    [showName]="false"
                    width="50px">
                  </profile-icon>
                </div>
                <div class="profile-card-details">
                  <h5 class="p-0 m-0">{{profile.name}}</h5>
                  <div class="profile-card-details-collection-list">
                    <list-concatinator
                      [list]="getCollectionListById(profile.id)"
                      lines="2"></list-concatinator>
                  </div>
                </div>
              </div>
            </card-button>
          </ng-container>
        </div>
      </div>
    </mat-dialog-content>
  </ng-container>
  <ng-container *ngSwitchCase="'new'">
      <mat-dialog-content>
          <div @transitionTrigger>
            <div>
              <div class="text-center">
                <profile-icon
                  [profile]="profile"
                  [showName]="true"
                  width="65px">
                </profile-icon>
              </div>
              <p>
                Select the Essential Collections you wish to pack on EVERY trip. Collections and Packables with weather rules will only be added once conditions are met.
              </p>
            </div>
            <div style="position: sticky;top:0;z-index:1; background: white;">
              <search-field
                [(value)]="searchString"
                placeholder="Search Collections">
              </search-field>
            </div>
            <div>
              <collection-selector
                [collections]="collections"
                [(selected)]="selectedCollections"
                [filterInput]="searchString">
              </collection-selector>
            </div>
          </div>
        </mat-dialog-content>
        <mat-dialog-actions>
          <dialog-confirm-button>
            <button
              mat-fab
              class="mx-1"
              activeColor="action"
              (click)="onComplete()"
              [disabled]="selectedCollections.length===0">
              <mat-icon>check</mat-icon>
            </button>
          </dialog-confirm-button>
        </mat-dialog-actions>
      
  </ng-container>
</ng-container>
